<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>RAG LMS Q&A</title>
  <style>
    body { font-family: Arial; margin: 24px; }
    .card { border: 1px solid #ddd; padding: 12px; border-radius: 8px; margin-bottom: 12px; }
    textarea{ width: 100%; height: 120px; }
  </style>
</head>
<body>
  <h2>Simple RAG PDF Q&A (LMS)</h2>

  <div class="card">
    <h3>1) Upload PDF</h3>
    <input type="file" id="pdfFile" accept="application/pdf" />
    <button onclick="upload()">Upload & Index</button>
    <div id="uploadResult"></div>
  </div>

  <div class="card">
    <h3>2) Ask a question</h3>
    <textarea id="question" placeholder="Ask a question about the uploaded PDF..."></textarea><br/>
    <button onclick="ask()">Ask</button>
    <div id="answer"></div>
  </div>

<script>
const backend = "http://localhost:8000";

async function upload(){
  const input = document.getElementById('pdfFile');
  if(!input.files.length){ alert("Choose a PDF first"); return; }
  const fd = new FormData();
  fd.append('file', input.files[0]);
  document.getElementById('uploadResult').innerText = "Uploading...";
  const res = await fetch(backend + '/upload', { method:'POST', body: fd });
  const j = await res.json();
  document.getElementById('uploadResult').innerText = JSON.stringify(j, null, 2);
}

async function ask(){
  const question = document.getElementById('question').value;
  document.getElementById('answer').innerText = "Thinking...";
  const res = await fetch(backend + '/query', {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({ question, top_k: 4 })
  });
  const j = await res.json();
  if(j.answer){
    document.getElementById('answer').innerText = "Answer:\n" + j.answer + "\n\nRetrieved snippets:\n" + JSON.stringify(j.retrieved, null, 2);
  }else{
    document.getElementById('answer').innerText = JSON.stringify(j, null, 2);
  }
}
</script>
</body>
</html>
